{% extends 'OroNavigationBundle:Menu:menu.html.twig' %}

{% macro get_options(attributes, data) %}
    {%- set options = {} %}
    {%- for attribute in attributes %}
        {%- if data[attribute] is defined %}
            {%- set options = options|merge({(attribute): data[attribute]}) %}
        {%- endif %}
    {%- endfor %}
    {%- if options %}
        {{- options|json_encode|raw -}}
    {% endif %}
{% endmacro %}

{% block list %}
    {% if item.hasChildren and options.depth is not sameas(0) and item.displayChildren %}
        {% set history = [] %}
        {% for historyItem in item.children %}
            {% if historyItem.extras.isAllowed %}
                {% set history = history|merge([{'id': historyItem.extras.id, 'title': historyItem.label, 'url': historyItem.uri, 'type': historyItem.extras.type}]) %}
            {% endif %}
        {% endfor %}
    {% endif %}

    {% import _self as navigation %}
    <script type="text/javascript">
        $(function () {
            var history = new navigation.history.MainView({{- navigation.get_options(['el', 'tabTitle', 'tabIcon'], options) -}});
            {% if history is defined %}
            history.getCollection().reset({{ history|json_encode|raw }});
            {% endif %}
        });
    </script>
{% endblock %}
